{"version":3,"sources":["webpack:///./source/scripts/components/ProductRowScroller.js","webpack:///./source/scripts/sections/StaticProductRecommendations.js"],"names":["ProductRowScroller","productRow","$window","$","window","flickity","$productRow","_mobileSlider","bind","layout","onBreakpointChange","offBreakpointChange","_destroyFlickity","Flickity","cellSelector","contain","freeScroll","percentPosition","prevNextButtons","pageDots","setGallerySize","_bindSlider","off","destroy","isGreaterThanBreakpoint","_initFlickity","$slider","find","on","debounce","trigger","height","Math","ceil","maxCellHeight","StaticProductRecommendations","section","productId","data","limit","settings","recommendedProducts","productsScroller","recommendationContainer","document","querySelector","recommendUrl","_loadRecommendations","_resizeRowScroller","AsyncView","load","view","then","html","innerHTML","rimg","watch","productItems","querySelectorAll","productItemLazyLoad","length","forEach","productItem","push","ProductGridItem","el","id","lazy","initShopifyProductReviews","moneyItems","money","CurrencyConverter","update","Shopify","PaymentButton","init","addEventListener","resize","unload","removeEventListener"],"mappings":"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","file":"StaticProductRecommendations.bundle.js","sourcesContent":["import debounce from 'just-debounce';\nimport Flickity from 'flickity';\n\nimport layout from '../Layout';\n\nexport default class ProductRowScroller {\n  constructor(productRow) {\n    this.$window = $(window);\n    this.flickity = null;\n    this.productRow = productRow;\n    this.$productRow = $(this.productRow);\n\n    // Activate flickity on mobile\n    this._mobileSlider = this._mobileSlider.bind(this);\n    layout.onBreakpointChange(this._mobileSlider);\n\n    this._mobileSlider();\n  }\n\n  unload() {\n    layout.offBreakpointChange(this._mobileSlider);\n    this._destroyFlickity();\n  }\n\n  _initFlickity() {\n    this.flickity = new Flickity(this.productRow, {\n      cellSelector: '.productgrid--item',\n      contain: true,\n      freeScroll: true,\n      percentPosition: false,\n      prevNextButtons: false,\n      pageDots: false,\n      setGallerySize: false,\n    });\n\n    this._bindSlider();\n  }\n\n  _destroyFlickity() {\n    if (!this.flickity) {\n      return;\n    }\n\n    this.$window.off('.product-row');\n    this.$productRow.off('.product-row');\n\n    this.flickity.destroy();\n    this.flickity = null;\n  }\n\n  _mobileSlider() {\n    // If is Large layout, attempt to destroy flickity\n    if (layout.isGreaterThanBreakpoint('M')) {\n      this._destroyFlickity();\n      return;\n    }\n\n    // Is XS/S/M, and flickity is init'd -- do nothing\n    if (this.flickity) {\n      return;\n    }\n\n    // Is XS/S/M, and flickity is not init'd\n    this._initFlickity();\n  }\n\n  _bindSlider() {\n    const $slider = this.$productRow.find('.flickity-slider');\n\n    this.$window.on('resize.product-row', debounce(() => {\n      this.$productRow.trigger('heightUpdate.product-row');\n    }));\n\n    this.flickity.on('cellSelect', () => {\n      this.$productRow.trigger('heightUpdate.product-row');\n    });\n\n    this.$productRow.on('heightUpdate.product-row', () => {\n      if (!this.flickity) {\n        return;\n      }\n\n      $slider.height(Math.ceil(this.flickity.maxCellHeight));\n    });\n\n    // Sets the Slider to the height of the first slide\n    this.$productRow.trigger('heightUpdate.product-row');\n  }\n}\n","import rimg from 'rimg-shopify'; // eslint-disable-line\nimport AsyncView from 'shopify-asyncview';\nimport CurrencyConverter from 'shopify-currency-converter';\nimport layout from '../Layout';\nimport ProductGridItem from '../components/ProductGridItem';\nimport ProductRowScroller from '../components/ProductRowScroller';\nimport { initShopifyProductReviews } from '../helpers/ProductReviews';\n\nexport default class StaticProductRecommendations {\n  constructor(section) {\n    this.section = section;\n    this.productId = section.data.productId;\n    this.limit = section.data.settings.limit;\n    this.recommendedProducts = [];\n    this.productsScroller = null;\n\n    this.recommendationContainer = document.querySelector('[data-product-recommendations]');\n\n    this.recommendUrl = `/recommendations/products?section_id=static-product-recommendations&limit=${this.limit}&product_id=${this.productId}`;\n\n    this._loadRecommendations = this._loadRecommendations.bind(this);\n    this._resizeRowScroller = this._resizeRowScroller.bind(this);\n\n    this._loadRecommendations();\n  }\n\n  _loadRecommendations() {\n    AsyncView.load(\n      this.recommendUrl,\n      { view: '' },\n    ).then(({ html }) => {\n      this.recommendationContainer.innerHTML = html;\n\n      rimg.watch(this.recommendationContainer);\n\n      const productItems = this.recommendationContainer.querySelectorAll('[data-product-item]');\n\n      const productItemLazyLoad = layout.isGreaterThanBreakpoint('L', true);\n\n      if (productItems.length) {\n        productItems.forEach(productItem => {\n          this.recommendedProducts.push(new ProductGridItem({\n            el: productItem,\n            id: this.section.id,\n            lazy: productItemLazyLoad,\n          }));\n        });\n\n        initShopifyProductReviews();\n\n        const moneyItems = this.recommendationContainer.querySelectorAll('.money');\n        moneyItems.forEach(money => CurrencyConverter.update(money));\n\n        if (window.Shopify && Shopify.PaymentButton) {\n          Shopify.PaymentButton.init();\n        }\n\n        this.recommendationContainer.addEventListener('rimg:load', this._resizeRowScroller);\n        this.productsScroller = new ProductRowScroller(this.section.el.querySelector('[data-product-row]'));\n      }\n    });\n  }\n\n  _resizeRowScroller() {\n    if (this.productsScroller && this.productsScroller.flickity) {\n      this.productsScroller.flickity.resize();\n    }\n  }\n\n  onSectionUnload() {\n    if (this.productsScroller) {\n      this.productsScroller.unload();\n    }\n\n    this.recommendedProducts.forEach(productItem => {\n      productItem.unload();\n    });\n\n    this.recommendationContainer.removeEventListener('rimg:load', this._resizeRowScroller);\n  }\n}\n"],"sourceRoot":""}