{"version":3,"sources":["webpack:///./source/scripts/sections/DynamicFeaturedCollection.js"],"names":["DynamicFeaturedCollection","section","el","contentWrapperEl","querySelector","contentEl","initialLayout","dataset","layout","productItems","productItemsEls","querySelectorAll","i","length","push","ProductGridItem","id","lazy","moneyEls","CurrencyConverter","update","window","requestAnimationFrame","_initializeFlickity","onBreakpointChange","useSlideshow","isLessThanBreakpoint","_destroyFlickity","forEach","productItem","unload","layoutHandler","offBreakpointChange","flickity","Flickity","autoPlay","accessibility","cellAlign","cellSelector","groupCells","pageDots","contain","arrowShape","resize","prototype","viewport","slider","sliderWrapper","document","createElement","classList","add","appendChild","r","style","height","call","removeChild","destroy"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AACA;;IAEqBA,yB;;;AACnB,qCAAYC,OAAZ,EAAqB;AAAA;;AAAA;;AACnB,SAAKA,OAAL,GAAeA,OAAf;AACA,SAAKC,EAAL,GAAUD,OAAO,CAACC,EAAlB;AACA,SAAKC,gBAAL,GAAwBF,OAAO,CAACC,EAAR,CAAWE,aAAX,CAAyB,wBAAzB,CAAxB;AACA,SAAKC,SAAL,GAAiBJ,OAAO,CAACC,EAAR,CAAWE,aAAX,CAAyB,gBAAzB,CAAjB;AAEA;;;;;;AAKA,SAAKE,aAAL,GAAqB,KAAKD,SAAL,CAAeE,OAAf,CAAuBC,MAA5C,CAXmB,CAanB;;AACA,SAAKC,YAAL,GAAoB,EAApB;AAEA,QAAMC,eAAe,GAAG,KAAKR,EAAL,CAAQS,gBAAR,CAAyB,qBAAzB,CAAxB;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,eAAe,CAACG,MAApC,EAA4CD,CAAC,EAA7C,EAAiD;AAC/C,WAAKH,YAAL,CAAkBK,IAAlB,CAAuB,IAAIC,2EAAJ,CAAoB;AACzCb,UAAE,EAAEQ,eAAe,CAACE,CAAD,CADsB;AAEzCI,UAAE,EAAEf,OAAO,CAACe,EAF6B;AAGzCC,YAAI,EAAE;AAHmC,OAApB,CAAvB;AAKD;;AAED,QAAMC,QAAQ,GAAG,KAAKhB,EAAL,CAAQS,gBAAR,CAAyB,6BAAzB,CAAjB;;AACA,SAAK,IAAIC,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAGM,QAAQ,CAACL,MAA7B,EAAqCD,EAAC,EAAtC,EAA0C;AACxCO,uEAAiB,CAACC,MAAlB,CAAyBF,QAAQ,CAACN,EAAD,CAAjC;AACD;;AAED,QAAI,KAAKN,aAAL,KAAuB,WAA3B,EAAwC;AACtCe,YAAM,CAACC,qBAAP,CAA6B;AAAA,eAAM,KAAI,CAACC,mBAAL,EAAN;AAAA,OAA7B;AACD,KAFD,MAEO;AACL,WAAKC,kBAAL,GAA0B,YAAM;AAC9B,YAAMC,YAAY,GAAGjB,uDAAM,CAACkB,oBAAP,CAA4B,IAA5B,CAArB;;AAEA,YAAID,YAAJ,EAAkB;AAChB,eAAI,CAACF,mBAAL;AACD,SAFD,MAEO;AACL,eAAI,CAACI,gBAAL;AACD;AACF,OARD;;AASAnB,6DAAM,CAACgB,kBAAP,CAA0B,KAAKA,kBAA/B;;AAEA,UAAIhB,uDAAM,CAACkB,oBAAP,CAA4B,IAA5B,CAAJ,EAAuC;AACrCL,cAAM,CAACC,qBAAP,CAA6B;AAAA,iBAAM,KAAI,CAACC,mBAAL,EAAN;AAAA,SAA7B;AACD;AACF;AACF;;;;sCAEiB;AAChB,WAAKd,YAAL,CAAkBmB,OAAlB,CAA0B,UAAAC,WAAW;AAAA,eAAIA,WAAW,CAACC,MAAZ,EAAJ;AAAA,OAArC;AACA,WAAKC,aAAL,CAAmBC,mBAAnB,CAAuC,KAAKR,kBAA5C;;AACA,WAAKG,gBAAL;AACD;;;0CAEqB;AACpB,UAAI,KAAKM,QAAT,EAAmB,OADC,CACO;;AAE3B,WAAK5B,SAAL,CAAeE,OAAf,CAAuBC,MAAvB,GAAgC,WAAhC;AACA,WAAKyB,QAAL,GAAgB,IAAIC,+CAAJ,CACd,KAAK7B,SADS,EAEd;AACE8B,gBAAQ,EAAE,CADZ;AAEEC,qBAAa,EAAE,IAFjB;AAGEC,iBAAS,EAAE,MAHb;AAIEC,oBAAY,EAAE,oBAJhB;AAKEC,kBAAU,EAAE,IALd;AAMEC,gBAAQ,EAAE,KANZ;AAOEC,eAAO,EAAE,IAPX;AAQEC,kBAAU,EAAE;AARd,OAFc,CAAhB;AAJoB,UAkBZC,MAlBY,GAkBDT,+CAAQ,CAACU,SAlBR,CAkBZD,MAlBY;AAmBpB,UAAME,QAAQ,GAAG,KAAKxC,SAAL,CAAeD,aAAf,CAA6B,oBAA7B,CAAjB;AACA,UAAM0C,MAAM,GAAG,KAAKzC,SAAL,CAAeD,aAAf,CAA6B,kBAA7B,CAAf;AAEA;;;;;;;;;;;;;AAYA,UAAM2C,aAAa,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAtB;AACAF,mBAAa,CAACG,SAAd,CAAwBC,GAAxB,CAA4B,0BAA5B;AACAN,cAAQ,CAACO,WAAT,CAAqBL,aAArB;AACAA,mBAAa,CAACK,WAAd,CAA0BN,MAA1B;;AAEA,WAAKb,QAAL,CAAcU,MAAd,GAAuB,SAASU,CAAT,GAAa;AAClCR,gBAAQ,CAACS,KAAT,CAAeC,MAAf,GAAwB,EAAxB;AACAZ,cAAM,CAACa,IAAP,CAAY,IAAZ;AACD,OAHD;AAID;;;uCAEkB;AACjB,UAAI,CAAC,KAAKvB,QAAV,EAAoB,OADH,CACW;;AAE5B,WAAK5B,SAAL,CAAeE,OAAf,CAAuBC,MAAvB,GAAgC,KAAKF,aAArC;AACA,UAAMuC,QAAQ,GAAG,KAAKxC,SAAL,CAAeD,aAAf,CAA6B,oBAA7B,CAAjB;AACA,UAAM0C,MAAM,GAAG,KAAKzC,SAAL,CAAeD,aAAf,CAA6B,kBAA7B,CAAf;AAEA;;;;;;AAKA,UAAM2C,aAAa,GAAG,KAAK1C,SAAL,CAAeD,aAAf,CAA6B,2BAA7B,CAAtB;AACAyC,cAAQ,CAACO,WAAT,CAAqBN,MAArB;AACAD,cAAQ,CAACY,WAAT,CAAqBV,aAArB;AAEA,WAAKd,QAAL,CAAcyB,OAAd;AACA,WAAKzB,QAAL,GAAgB,IAAhB;AACD","file":"DynamicFeaturedCollection.bundle.js","sourcesContent":["import Flickity from 'flickity';\nimport CurrencyConverter from 'shopify-currency-converter';\n\nimport ProductGridItem from '../components/ProductGridItem';\nimport layout from '../Layout';\n\nexport default class DynamicFeaturedCollection {\n  constructor(section) {\n    this.section = section;\n    this.el = section.el;\n    this.contentWrapperEl = section.el.querySelector('[data-content-wrapper]');\n    this.contentEl = section.el.querySelector('[data-content]');\n\n    /*\n     * We keep reference to the original layout of the collection\n     * because dependent upon viewport width, we may need to enforce\n     * one layout over the other.\n     */\n    this.initialLayout = this.contentEl.dataset.layout;\n\n    // Product items\n    this.productItems = [];\n\n    const productItemsEls = this.el.querySelectorAll('[data-product-item]');\n    for (let i = 0; i < productItemsEls.length; i++) {\n      this.productItems.push(new ProductGridItem({\n        el: productItemsEls[i],\n        id: section.id,\n        lazy: false,\n      }));\n    }\n\n    const moneyEls = this.el.querySelectorAll('.money:not([data-currency])');\n    for (let i = 0; i < moneyEls.length; i++) {\n      CurrencyConverter.update(moneyEls[i]);\n    }\n\n    if (this.initialLayout === 'slideshow') {\n      window.requestAnimationFrame(() => this._initializeFlickity());\n    } else {\n      this.onBreakpointChange = () => {\n        const useSlideshow = layout.isLessThanBreakpoint('XL');\n\n        if (useSlideshow) {\n          this._initializeFlickity();\n        } else {\n          this._destroyFlickity();\n        }\n      };\n      layout.onBreakpointChange(this.onBreakpointChange);\n\n      if (layout.isLessThanBreakpoint('XL')) {\n        window.requestAnimationFrame(() => this._initializeFlickity());\n      }\n    }\n  }\n\n  onSectionUnload() {\n    this.productItems.forEach(productItem => productItem.unload());\n    this.layoutHandler.offBreakpointChange(this.onBreakpointChange);\n    this._destroyFlickity();\n  }\n\n  _initializeFlickity() {\n    if (this.flickity) return; // Already initialized\n\n    this.contentEl.dataset.layout = 'slideshow';\n    this.flickity = new Flickity(\n      this.contentEl,\n      {\n        autoPlay: 0,\n        accessibility: true,\n        cellAlign: 'left',\n        cellSelector: '.productgrid--item',\n        groupCells: true,\n        pageDots: false,\n        contain: true,\n        arrowShape: 'M65.29 11.99L27.28 50L65.3 87.99L70.25 83.06L37.19 50L70.26 16.94L65.29 11.99Z',\n      },\n    );\n\n    const { resize } = Flickity.prototype;\n    const viewport = this.contentEl.querySelector('.flickity-viewport');\n    const slider = this.contentEl.querySelector('.flickity-slider');\n\n    /*\n     * We must wrap Flickity's slider element to allow the usage of\n     * clip, and clip-path to obscure the overflow product items.\n     * To use clip, and clip-path, the clipped element must be absolutely\n     * positioned. In this case, the only native Flickity element\n     * that is absolutely positioned is the slider; but, it moves with the first\n     * slide rather than remaining in the viewport removing it as a candidate.\n     * Therefore, it is necessary to include a wrapper element that we can\n     * absolutely position that remains within the viewport.\n     * The only thing we need to watch out for is that the elements\n     * are moved in a non-destructive manner.\n     */\n    const sliderWrapper = document.createElement('div');\n    sliderWrapper.classList.add('flickity-slider--wrapper');\n    viewport.appendChild(sliderWrapper);\n    sliderWrapper.appendChild(slider);\n\n    this.flickity.resize = function r() {\n      viewport.style.height = '';\n      resize.call(this);\n    };\n  }\n\n  _destroyFlickity() {\n    if (!this.flickity) return; // Already uninitialized\n\n    this.contentEl.dataset.layout = this.initialLayout;\n    const viewport = this.contentEl.querySelector('.flickity-viewport');\n    const slider = this.contentEl.querySelector('.flickity-slider');\n\n    /*\n     * Remember to move the Flickity native elements back\n     * into the correct DOM layout, before removing the added\n     * wrapper.\n     */\n    const sliderWrapper = this.contentEl.querySelector('.flickity-slider--wrapper');\n    viewport.appendChild(slider);\n    viewport.removeChild(sliderWrapper);\n\n    this.flickity.destroy();\n    this.flickity = null;\n  }\n}\n"],"sourceRoot":""}